<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kaleidofin WEE Fund Budget Simulator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .input-group-label { font-size: 0.875rem; font-weight: 500; color: #374151; }
        .input-field { width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem; margin-top: 0.25rem; }
        .result-card { background: white; padding: 1.5rem; border-radius: 0.5rem; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1); }
        .tooltip { position: relative; display: inline-block; cursor: pointer; }
        .tooltip .tooltiptext { visibility: hidden; width: 200px; background-color: #555; color: #fff; text-align: center; border-radius: 6px; padding: 5px; position: absolute; z-index: 1; bottom: 125%; left: 50%; margin-left: -100px; opacity: 0; transition: opacity 0.3s; }
        .tooltip:hover .tooltiptext { visibility: visible; opacity: 1; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen font-sans text-gray-900">

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <header class="mb-8">
            <h1 class="text-3xl font-bold text-gray-900">Financial Model: WEE Fund Budget Simulator</h1>
            <p class="text-gray-600 mt-2">Simulate scenarios by adjusting partner counts, cost structures, and assumptions.</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <!-- Sidebar: Controls -->
            <div class="lg:col-span-4 space-y-6">
                
                <!-- Partner Counts -->
                <div class="bg-white p-6 rounded-lg shadow border border-gray-200">
                    <h2 class="text-lg font-semibold mb-4 text-blue-700">1. Partner Mix Scenarios</h2>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="input-group-label">Group 1: First (Market Opener)</label>
                            <input type="number" id="count_g1_first" value="6" class="input-field" oninput="calculate()">
                        </div>
                        <div>
                            <label class="input-group-label">Group 1: Subsequent</label>
                            <input type="number" id="count_g1_sub" value="14" class="input-field" oninput="calculate()">
                        </div>
                        <div class="border-t border-gray-200 my-4"></div>
                        <div>
                            <label class="input-group-label">Group 2: First (Market Opener)</label>
                            <input type="number" id="count_g2_first" value="2" class="input-field" oninput="calculate()">
                        </div>
                        <div>
                            <label class="input-group-label">Group 2: Hybrid (Entering G1 Market)</label>
                            <input type="number" id="count_g2_hybrid" value="2" class="input-field" oninput="calculate()">
                        </div>
                        <div>
                            <label class="input-group-label">Group 2: Subsequent</label>
                            <input type="number" id="count_g2_sub" value="10" class="input-field" oninput="calculate()">
                        </div>
                    </div>
                </div>

                <!-- Global Assumptions -->
                <div class="bg-white p-6 rounded-lg shadow border border-gray-200">
                    <h2 class="text-lg font-semibold mb-4 text-blue-700">2. Model Assumptions</h2>
                    <div class="space-y-4">
                        <div>
                            <label class="input-group-label">Number of Unique Models Developed</label>
                            <input type="number" id="unique_models" value="4" class="input-field" oninput="calculate()">
                            <p class="text-xs text-gray-500 mt-1">Drives separate maintenance cost line item.</p>
                        </div>
                        <div>
                            <label class="input-group-label">Program Duration (Years)</label>
                            <input type="number" id="duration" value="4" class="input-field" oninput="calculate()">
                        </div>
                    </div>
                </div>

                <!-- Cost Configuration (Collapsible) -->
                <div class="bg-white p-6 rounded-lg shadow border border-gray-200">
                    <div class="flex justify-between items-center cursor-pointer" onclick="toggleCosts()">
                        <h2 class="text-lg font-semibold text-blue-700">3. Cost Configuration</h2>
                        <span id="cost-toggle-icon">▼</span>
                    </div>
                    
                    <div id="cost-config" class="hidden mt-4 space-y-4">
                        <h3 class="font-medium text-gray-800 border-b pb-1">Unit Costs ($)</h3>
                        
                        <div class="grid grid-cols-2 gap-2">
                            <div>
                                <label class="text-xs font-semibold">Integ Setup (First)</label>
                                <input type="number" id="cost_integ_first" value="60000" class="input-field text-sm" oninput="calculate()">
                            </div>
                            <div>
                                <label class="text-xs font-semibold">Integ Setup (Sub)</label>
                                <input type="number" id="cost_integ_sub" value="40000" class="input-field text-sm" oninput="calculate()">
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-2">
                            <div>
                                <label class="text-xs font-semibold">Feat Eng (First)</label>
                                <input type="number" id="cost_feat_first" value="30000" class="input-field text-sm" oninput="calculate()">
                            </div>
                            <div>
                                <label class="text-xs font-semibold">Feat Eng (Sub)</label>
                                <input type="number" id="cost_feat_sub" value="20000" class="input-field text-sm" oninput="calculate()">
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-2">
                            <div>
                                <label class="text-xs font-semibold">Model Calib (First)</label>
                                <input type="number" id="cost_calib_first" value="117000" class="input-field text-sm" oninput="calculate()">
                            </div>
                            <div>
                                <label class="text-xs font-semibold">Model Calib (Sub)</label>
                                <input type="number" id="cost_calib_sub" value="47000" class="input-field text-sm" oninput="calculate()">
                            </div>
                        </div>

                        <div>
                            <label class="text-xs font-semibold">Partner Annual Maintenance (per year)</label>
                            <input type="number" id="cost_maint_partner_yr" value="14000" class="input-field text-sm" oninput="calculate()">
                            <p class="text-xs text-gray-500">Default: $56k / 4 years = $14k/yr</p>
                        </div>

                        <div>
                            <label class="text-xs font-semibold">Unique Model Maintenance (per year)</label>
                            <input type="number" id="cost_maint_model_yr" value="30000" class="input-field text-sm" oninput="calculate()">
                        </div>

                        <h3 class="font-medium text-gray-800 border-b pb-1 mt-4">Partner Co-Pay (Total 4 Years)</h3>
                        <div class="grid grid-cols-2 gap-2">
                            <div>
                                <label class="text-xs font-semibold">Group 1 Total</label>
                                <input type="number" id="copay_g1" value="60000" class="input-field text-sm" oninput="calculate()">
                            </div>
                            <div>
                                <label class="text-xs font-semibold">Group 2 Total</label>
                                <input type="number" id="copay_g2" value="100000" class="input-field text-sm" oninput="calculate()">
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Main Content: Output -->
            <div class="lg:col-span-8 space-y-8">
                
                <!-- KPI Cards -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="result-card border-l-4 border-blue-500">
                        <p class="text-sm font-medium text-gray-500">Total Partners</p>
                        <p class="text-3xl font-bold text-gray-900" id="total_partners">0</p>
                    </div>
                    <div class="result-card border-l-4 border-green-500">
                        <p class="text-sm font-medium text-gray-500">Net Grant Ask</p>
                        <p class="text-3xl font-bold text-green-600" id="net_grant_ask">$0</p>
                    </div>
                     <div class="result-card border-l-4 border-purple-500">
                        <p class="text-sm font-medium text-gray-500">Gross Budget</p>
                        <p class="text-3xl font-bold text-purple-600" id="total_gross">$0</p>
                    </div>
                </div>

                <!-- Detailed Breakdown Table -->
                <div class="bg-white rounded-lg shadow overflow-hidden">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-bold text-gray-900">Budget Breakdown</h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Group & Role</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Count</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Unit Gross</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Total Gross</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Total Co-Pay</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Net Grant</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200" id="breakdown_body">
                                <!-- Rows will be inserted here by JS -->
                            </tbody>
                            <tfoot class="bg-gray-50 font-bold">
                                <tr>
                                    <td class="px-6 py-3">TOTAL</td>
                                    <td class="px-6 py-3 text-right" id="ft_count">0</td>
                                    <td class="px-6 py-3 text-right">-</td>
                                    <td class="px-6 py-3 text-right" id="ft_gross">$0</td>
                                    <td class="px-6 py-3 text-right" id="ft_copay">$0</td>
                                    <td class="px-6 py-3 text-right text-green-700" id="ft_net">$0</td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>

                <!-- Verification / Logic Section -->
                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="text-lg font-bold text-gray-900 mb-4">Verification & Logic "Behind the Scenes"</h3>
                    <div class="text-sm text-gray-600 space-y-2">
                        <p><strong>Formula Logic:</strong></p>
                        <ul class="list-disc pl-5 space-y-1">
                            <li><strong>Unit Gross Cost</strong> = Integration + Feature Eng + Model Calibration + (Partner Maint/Yr × Duration).</li>
                            <li><strong>Group 1 First:</strong> <span id="logic_g1_first"></span></li>
                            <li><strong>Group 1 Sub:</strong> <span id="logic_g1_sub"></span></li>
                            <li><strong>Group 2 First:</strong> <span id="logic_g2_first"></span></li>
                            <li><strong>Group 2 Hybrid:</strong> <span id="logic_g2_hybrid"></span> (Uses Sub Integ/Feat but First Calib).</li>
                            <li><strong>Group 2 Sub:</strong> <span id="logic_g2_sub"></span></li>
                            <li><strong>Model Maintenance:</strong> <span id="logic_models"></span> (Charged separately per unique model, not per partner).</li>
                        </ul>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        function toggleCosts() {
            const el = document.getElementById('cost-config');
            el.classList.toggle('hidden');
        }

        function fmt(num) {
            return '$' + num.toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 0});
        }

        function getVal(id) {
            return parseFloat(document.getElementById(id).value) || 0;
        }

        function calculate() {
            // Inputs
            const counts = {
                g1_first: getVal('count_g1_first'),
                g1_sub: getVal('count_g1_sub'),
                g2_first: getVal('count_g2_first'),
                g2_hybrid: getVal('count_g2_hybrid'),
                g2_sub: getVal('count_g2_sub')
            };

            const models = getVal('unique_models');
            const duration = getVal('duration');

            const costs = {
                integ_first: getVal('cost_integ_first'),
                integ_sub: getVal('cost_integ_sub'),
                feat_first: getVal('cost_feat_first'),
                feat_sub: getVal('cost_feat_sub'),
                calib_first: getVal('cost_calib_first'),
                calib_sub: getVal('cost_calib_sub'),
                maint_partner_yr: getVal('cost_maint_partner_yr'),
                maint_model_yr: getVal('cost_maint_model_yr'),
            };

            const copay = {
                g1: getVal('copay_g1'),
                g2: getVal('copay_g2')
            };

            const partner_maint_total = costs.maint_partner_yr * duration;

            // Define Unit Gross Calculations
            // G1: Integ + Feat + Maint (No Calib)
            const unit_g1_first = costs.integ_first + costs.feat_first + partner_maint_total;
            const unit_g1_sub = costs.integ_sub + costs.feat_sub + partner_maint_total;

            // G2: Integ + Feat + Calib + Maint
            const unit_g2_first = costs.integ_first + costs.feat_first + costs.calib_first + partner_maint_total;
            
            // G2 Hybrid: Sub Integ + Sub Feat + First Calib + Maint
            const unit_g2_hybrid = costs.integ_sub + costs.feat_sub + costs.calib_first + partner_maint_total;
            
            const unit_g2_sub = costs.integ_sub + costs.feat_sub + costs.calib_sub + partner_maint_total;

            // Rows Data
            const rows = [
                { name: "Group 1: First", count: counts.g1_first, unit: unit_g1_first, copay: copay.g1 },
                { name: "Group 1: Subsequent", count: counts.g1_sub, unit: unit_g1_sub, copay: copay.g1 },
                { name: "Group 2: First", count: counts.g2_first, unit: unit_g2_first, copay: copay.g2 },
                { name: "Group 2: Hybrid", count: counts.g2_hybrid, unit: unit_g2_hybrid, copay: copay.g2 },
                { name: "Group 2: Subsequent", count: counts.g2_sub, unit: unit_g2_sub, copay: copay.g2 },
            ];

            // Add Model Maintenance Row
            const model_maint_total = models * costs.maint_model_yr * duration;
            // Treat as a row but unit cost is per model
            // Actually it's cleaner to just show it as a line item with total.
            
            let total_count = 0;
            let total_gross = 0;
            let total_copay = 0;
            let total_net = 0;

            let html = "";

            rows.forEach(r => {
                const row_gross = r.count * r.unit;
                const row_copay = r.count * r.copay;
                const row_net = row_gross - row_copay;

                total_count += r.count;
                total_gross += row_gross;
                total_copay += row_copay;
                total_net += row_net;

                html += `<tr>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${r.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-right">${r.count}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-right">${fmt(r.unit)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right font-medium">${fmt(row_gross)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-red-500 text-right">(${fmt(row_copay)})</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-green-600 text-right font-bold">${fmt(row_net)}</td>
                </tr>`;
            });

            // Model Maintenance Row
            html += `<tr class="bg-yellow-50">
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Model Maintenance (${models} Models)</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-right">${models}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-right">${fmt(costs.maint_model_yr * duration)}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right font-medium">${fmt(model_maint_total)}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-red-500 text-right">($0)</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-green-600 text-right font-bold">${fmt(model_maint_total)}</td>
            </tr>`;

            total_gross += model_maint_total;
            total_net += model_maint_total;

            document.getElementById('breakdown_body').innerHTML = html;

            // Update Footer
            document.getElementById('ft_count').innerText = total_count; // Don't add models to partner count
            document.getElementById('ft_gross').innerText = fmt(total_gross);
            document.getElementById('ft_copay').innerText = '(' + fmt(total_copay) + ')';
            document.getElementById('ft_net').innerText = fmt(total_net);

            // Update Cards
            document.getElementById('total_partners').innerText = total_count;
            document.getElementById('total_gross').innerText = fmt(total_gross);
            document.getElementById('net_grant_ask').innerText = fmt(total_net);

            // Update Logic Explanations
            document.getElementById('logic_g1_first').innerText = `First Integ (${fmt(costs.integ_first)}) + First Feat (${fmt(costs.feat_first)}) + Partner Maint (${fmt(partner_maint_total)}) = ${fmt(unit_g1_first)}`;
            document.getElementById('logic_g1_sub').innerText = `Sub Integ (${fmt(costs.integ_sub)}) + Sub Feat (${fmt(costs.feat_sub)}) + Partner Maint (${fmt(partner_maint_total)}) = ${fmt(unit_g1_sub)}`;
            document.getElementById('logic_g2_first').innerText = `First Integ (${fmt(costs.integ_first)}) + First Feat (${fmt(costs.feat_first)}) + First Calib (${fmt(costs.calib_first)}) + Partner Maint (${fmt(partner_maint_total)}) = ${fmt(unit_g2_first)}`;
            document.getElementById('logic_g2_hybrid').innerText = `Sub Integ (${fmt(costs.integ_sub)}) + Sub Feat (${fmt(costs.feat_sub)}) + First Calib (${fmt(costs.calib_first)}) + Partner Maint (${fmt(partner_maint_total)}) = ${fmt(unit_g2_hybrid)}`;
            document.getElementById('logic_g2_sub').innerText = `Sub Integ (${fmt(costs.integ_sub)}) + Sub Feat (${fmt(costs.feat_sub)}) + Sub Calib (${fmt(costs.calib_sub)}) + Partner Maint (${fmt(partner_maint_total)}) = ${fmt(unit_g2_sub)}`;
            document.getElementById('logic_models').innerText = `${models} Models × ${fmt(costs.maint_model_yr)}/yr × ${duration} years = ${fmt(model_maint_total)}`;
        }

        // Init
        calculate();
    </script>
</body>
</html>
